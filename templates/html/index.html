{% extends "base.html" %}

{% block css %}
<script src="static/js/jquery.js"></script>
<script src="static/js/Chart.bundle.min.js"></script>
<script src="static/js/moment.js"></script>
{% end %}

{% block header %}
<header class="intro-header" style="background-image: url('static/img/home-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="site-heading">
                    <h2>Share Your Experience</h2>
                    <hr class="small">
                    <span id='description' class="subheading">A Way to keep track of the Cisco Intern Journey</span><br>
                </div>
            </div>
        </div>
    </div>
</header>
{% end %}


<!-- Main Content -->
{% block content %}
<div class="row">
  <div id="chart" class="col-lg-8 col-lg-offset-2">
    <canvas id="feelings-chart" height="160"></canvas>
  </div>
</div>

<div class="row">
    <div id='results' class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    </div>
</div>

<script>
    var feelingsData = [];
    var labelsData = [];
    var bgColorData = [];
    var brdrColorData = [];

    $.ajax({
        type:"GET",
        url:"/top"
    }).complete(function(o){
        j = o.responseText;
        console.log(j);
        obj = JSON.parse(j);
        $("#results").html("");
        for (var i = 0; i < obj.length; i++) {
            feelingsData.push(obj[i].feeling);
            labelsData.push(i);
            bgColorData.push("rgba(255, 99, 132, 0.2)");
            brdrColorData.push("rgba(255, 206, 86, 1)");
            $("#results").append($("<div>", {"class":"post-preview"}).append(
                $("<h2>", {"class":"post-title"}).text(obj[i].title).append(
                    $("<h3>", {"class":"post-subtitle"}).text(obj[i].content.slice(0,15) + "...\n" + "Feeling: " + obj[i].feeling).css("font-weight","normal")
                .append(
                    $("<p>", {"class":"post-meta"}).text("Posted by: " + obj[i].author)))
            )).append($("<a>",{"class":"btn btn-sm btn-primary","href":"#","text":"Likes: " + obj[i].likes + " "}).append($("<span>",{"class":"glyphicon glyphicon-thumbs-up"}))).append("<hr>");
        }
        $("#results").html($("#results").html().replace(/\n/g,'<br/>'));
        createChart(feelingsData, labelsData);

    })


    function createChart(feelingsData, labelsData) {
      var ctx = document.getElementById("feelings-chart");
      var myChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labelsData,
          datasets: [{
            label: "Intern Feelings",
            data: feelingsData,
            backgroundColor: bgColorData,
            borderColor: brdrColorData,
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            yAxes: [{
              ticks: {
                beginAtZero:true
              }
            }]
          },
          responsive:true
        }
      });
  }
</script>
{% end %}
