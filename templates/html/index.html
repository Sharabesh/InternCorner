{% extends "base.html" %}

{% block css %}
<script src="static/js/jquery.js"></script>
<script src="static/js/Chart.bundle.min.js"></script>
<script src="static/js/moment.js"></script>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Roboto'>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">




<style>

    .top-buffer {
      margin-top: 15px;
    }

    body {
      color: teal;
    }

    h1, h3, th {
      text-align: center;
    }

</style>

{% end %}

{% block header %}
<header class="intro-header" style="background-image: url('static/img/home-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="site-heading">
                    <h2>Share Your Experience</h2>
                    <hr class="small">
                    <span id='description' class="subheading">A Way to keep track of the Cisco Intern Journey</span><br>
                </div>
            </div>
        </div>
    </div>
</header>
{% end %}

<!-- Main Content -->
{% block content %}

<!--Cisco Headlines-->
<div class="container">
<h1>Cisco Headlines</h1>
<hr>
  <div class="row top-buffer">
    <div class="col-lg-5 w3-card-4">
        <div id="news1">
        </div>
    </div>

    <div class="col-lg-2">
    </div>

    <div class="col-lg-5 w3-card-4">
        <div id="news2">
        </div>
    </div>
  </div>

  <div class="row top-buffer">
    <div class="col-lg-5 w3-card-4">
        <div id="news3">
        </div>
    </div>

    <div class="col-lg-2">
    </div>

    <div class="col-lg-5 w3-card-4">
        <div id="news4">
        </div>
    </div>
  </div>
</div>

<!--Leaderboard Section-->
<div class="container top-buffer">
<h1>Leaderboards</h1>
<hr>

  <div class="row top-buffer">
    <div class="col-lg-5 ">
      <h3>Most Likes   üëç</h3>
        <table id="mostLikes" class="table w3-card-4">
            <thead>
            <tr>
                <th>#</th>
                <th>Post</th>
                <th>Likes</th>
            </tr>
            </thead>
        </table>
    </div>

    <div class="col-lg-2">
    </div>

    <div class="col-lg-5 ">
      <h3>Top Streaks   üî•</h3>
        <table id="topStreaks" class="table w3-card-4">
            <thead>
            <tr>
                <th>#</th>
                <th>Name</th>
                <th>Streak</th>
            </tr>
            </thead>
        </table>
    </div>

  </div>

  <div class="row top-buffer">
    <div class="col-lg-3"></div>

    <div class="col-lg-6">
      <h3>Post of the Day   ‚úèÔ∏è</h3>
      <div class=" w3-card-4">
        <div id="quote" class="w3-container"></div>
      </div>
    </div>

    <div class="col-lg-3"></div>
  </div>
</div>


<script>

<!--Cisco Headlines-->


    $.ajax({
        type: "GET",
        url: "/admin-posts",
    }).complete(function (o) {
        var now = moment();
        j = o.responseText;
        console.log(j)
        obj = JSON.parse(j)
        for(var i = 0; i<4; i++)
        {
            $("#news" + (i+1)).append($("<h2>", {"style":"text-align: center; padding-top: 20px; padding-bottom: 40px; color: teal;"}).text(obj[i]["title"]));
            $("#news" + (i+1)).append($("<h4>", {"stlye":"text-align: left; padding-bottom: 60px; padding-right: 80px"}).text(obj[i]["content"]));
            var time_posted = moment((obj[i].time_posted)); //Time Posted in seconds
            var diff = getDateDiff(now, time_posted);
            console.log(diff);
            $("#news" + (i+1)).append($("<p>", {"stlye":"text-align: left; padding-bottom: 60px; padding-right: 80px"}).text(diff));

        }
    });

    $("#more").append($("<button>", {"id": "but", "style": "width: 300px"}).text("More"));

    $(function(){

        $("#but").click(function(event){

            event.preventDefault();
            $(this).id("new").show();

        });

    });



//    $.ajax({
//        type: "GET",
//        url: "/admin-posts",
//    }).complete(function (o) {
//        var now = moment();
//        j = o.responseText;
//        console.log(j)
//        obj = JSON.parse(j)
//        $("#news5").append($("<h2>", {"style":"text-align: center; padding-top: 20px; padding-bottom: 40px; color: teal;"}).text(obj[0]["title"]));
//        $("#news5").append($("<h4>", {"stlye":"text-align: left; padding-bottom: 60px; padding-right: 80px"}).text(obj[0]["content"]));
//        var time_posted = moment((obj[i].time_posted)); //Time Posted in seconds
//        var diff = getDateDiff(now, time_posted);
//        $("#news5").append($("<p>", {"stlye":"text-align: left; padding-bottom: 60px; padding-right: 80px"}).text(diff));
//    });


    //Returns time elapsed between two dates
    var units = ["years", "months", "weeks", "days", "hours", "minutes", "seconds"];
    function getDateDiff(now, time_posted) {
        for(var i = 0; i < units.length; ++i) {
            var diff = now.diff(time_posted, units[i]);
            if (diff) { return formatDateDiff(diff, units[i]); }
        }
    }

    //Returns formatted date difference string
    function formatDateDiff(diff, unit) {
        if (diff == 1) { return diff + " " + unit.slice(0,unit.length-1) +  " ago."} //singular (take off 's')
        else { return diff + " " + unit + " ago."} //plural
    }


<!--Leaderboards-->

    $.ajax({
        type: "GET",
        url: "/mostLikes",
    }).complete(function (o) {
        j = o.responseText;
        console.log(j);
        obj = JSON.parse(j);
        for(var i=0; i<3; i++)
        {
            var row = $("<tr>");
            row.append($("<td>").text(i+1));


//            This is to truncate the amount of characters
            ana = obj[i]["content"];
            if(ana.length>55)
            {
                ana = ana.substring(0,55) + "...";
            }


            row.append($("<td>").text(ana));
            row.append($("<td>").text(obj[i]["likes"]));
            $("#mostLikes").append(row);
        }

    });

    $.ajax({
        type: "GET",
        url: "/topStreaks",
    }).complete(function (o) {
        j = o.responseText;
        console.log(j);
        obj = JSON.parse(j);
        for(var i=0; i<3; i++)
        {
            var row = $("<tr>");
            row.append($("<td>").text(i+1))
            row.append($("<td>").text(obj[i]["firstname"] + " " + obj[i]["lastname"]));
            row.append($("<td>").text(obj[i]["streak"]));
            row.append($("<br>"));
            $("#topStreaks").append(row);
        }

    });


    $.ajax({
        type: "GET",
        url: "/postOfDay"
    }).complete(function (o) {
        j = o.responseText;
        console.log(j);
        obj = JSON.parse(j);
        //$("#quote").append($("<div>").append($("<h4>", {"id":"target"}).text("Title: " + obj[0]["title"] + "\nPost: " + obj[0]["content"])));
        //$("#quote").html($("#quote").html().replace(/\n/g,'<br/>'));

        $("#quote").append($("<h2>", {"style":"text-align: center; padding-top: 20px; padding-bottom: 40px; color: teal; font-style: italic;"}).text(obj[0]["title"]));
        $("#quote").append($("<h4>", {"stlye":"text-align: left; padding-bottom: 60px; padding-right: 80px"}).text("‚ùù" + obj[0]["content"] + "‚ùû"));
        $("#quote").append($("<h4>", {"style": "text-align: center; padding-bottom: 40px; padding-left: 210px; padding-top: 40px"}).text("-" + obj[0]["author"]));


    });


</script>






{% end %}
